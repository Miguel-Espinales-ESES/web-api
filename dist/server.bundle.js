!function(e){var t={};function n(o){if(t[o])return t[o].exports;var i=t[o]={i:o,l:!1,exports:{}};return e[o].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=e,n.c=t,n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(o,i,function(t){return e[t]}.bind(null,i));return o},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=22)}([function(e,t){e.exports=require("type-graphql")},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const o=n(17),i=(e=500)=>{let t;switch(e){case 403:t="UNAUTHORIZED";break;case 401:t="UNAUTHENTICATED";break;case 400:t="BAD_REQUEST";break;case 404:t="NOT_FOUND";break;case 429:t="TOO_MANY_REQUESTS";break;case 413:t="QUERY_QUOTA_EXCEEDED";break;default:t="INTERNAL_SERVER_ERROR"}return t};class r extends o.ApolloError{constructor(e,t){super(e,i(t)),this.code=t,this.message=e}}t.default=r},function(e,t){e.exports=require("@typegoose/typegoose")},function(e,t){e.exports=require("class-validator")},function(e,t,n){"use strict";var o=this&&this.__decorate||function(e,t,n,o){var i,r=arguments.length,a=r<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(r<3?i(a):r>3?i(t,n,a):i(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a},i=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},r=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(i,r){function a(e){try{l(o.next(e))}catch(e){r(e)}}function s(e){try{l(o.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}l((o=o.apply(e,t||[])).next())}))},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=n(0),l=n(2),d=a(n(8)),c=n(9),p=n(6),u=n(7);let f=class extends c.Base{};o([s.Field(()=>s.ID),i("design:type",String)],f.prototype,"id",void 0),o([l.prop({required:!0,text:!0,index:!0}),s.Field({nullable:!1}),i("design:type",String)],f.prototype,"name",void 0),o([l.prop({required:!1,text:!0}),s.Field({nullable:!0}),i("design:type",String)],f.prototype,"description",void 0),f=o([l.pre("remove",(function(e){return r(this,void 0,void 0,(function*(){yield p.userModel.updateMany({permissions:{$in:this._id}},{$pull:this._id}),yield u.roleModel.updateMany({permissions:{$in:this._id}},{$pull:this._id}),e()}))})),s.ObjectType(),l.modelOptions({schemaOptions:{timestamps:!0}}),l.plugin(d.default)],f),t.Permission=f,t.permissionModel=l.getModelForClass(f)},function(e,t,n){"use strict";var o=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(i,r){function a(e){try{l(o.next(e))}catch(e){r(e)}}function s(e){try{l(o.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}l((o=o.apply(e,t||[])).next())}))},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=n(6),a=n(0),s=i(n(1));t.createUser=({email:e,password:t,firstName:n,lastName:i,confirmPassword:a})=>new Promise((l,d)=>o(void 0,void 0,void 0,(function*(){try{if(yield r.userModel.findOne({email:e}))throw new s.default("Unable to process your request with the provided email",400);if(t!==a)throw new s.default("The passwords do not match",400);const o=yield r.userModel.create({firstName:n,lastName:i,password:t,email:e});l(o)}catch(e){d(e)}}))),t.legibleTime=e=>{switch(!0){case e.includes("h"):return e.replace("h"," hour(s)");case e.includes("w"):return e.replace("w"," week(s)");case e.includes("d"):return e.replace("d"," day(s)");default:return e}},t.createFilters=(e,t)=>{const n=e.schema,o=Object.entries(n.paths).reduce((e,t)=>{const{options:n}=t[1];return n.text&&(e.textIndexes[t[0].toUpperCase()]=t[0]),n.index&&(e.regularIndexes[t[0].toUpperCase()]=t[0]),e},{textIndexes:{},regularIndexes:{}});return Object.keys(o.regularIndexes).length&&a.registerEnumType(o.regularIndexes,{name:`${t}SortType`}),Object.keys(o.textIndexes).length&&a.registerEnumType(o.textIndexes,{name:`${t}FilterType`}),o},t.capitalize=e=>"string"!=typeof e?"":e.charAt(0).toUpperCase()+e.slice(1)},function(e,t,n){"use strict";var o=this&&this.__decorate||function(e,t,n,o){var i,r=arguments.length,a=r<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(r<3?i(a):r>3?i(t,n,a):i(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a},i=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},r=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(i,r){function a(e){try{l(o.next(e))}catch(e){r(e)}}function s(e){try{l(o.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}l((o=o.apply(e,t||[])).next())}))},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=n(0),l=n(2),d=n(0),c=n(7),p=n(4),u=a(n(18)),f=a(n(27)),y=a(n(13)),m=a(n(15)),h=a(n(8)),g=n(9),b=a(n(1)),{GLOBAL_SECRET:v,EMAIL_VERIFICATION_EXPIRY:_}=process.env;let w=class extends g.Base{};o([d.Field(()=>d.ID),i("design:type",String)],w.prototype,"id",void 0),o([l.prop({required:!0,index:!0,text:!0}),d.Field({nullable:!1}),i("design:type",String)],w.prototype,"firstName",void 0),o([l.prop({required:!0}),d.Field({nullable:!1}),i("design:type",String)],w.prototype,"lastName",void 0),o([l.prop({lowercase:!0,required:!0}),d.Field({nullable:!1}),i("design:type",String)],w.prototype,"email",void 0),o([l.prop({required:!0}),i("design:type",String)],w.prototype,"password",void 0),o([l.prop({ref:c.Role}),d.Field(()=>c.Role,{nullable:!1}),i("design:type",Object)],w.prototype,"role",void 0),o([l.arrayProp({itemsRef:"Permission"}),d.Field(()=>[p.Permission],{nullable:!0}),i("design:type",Array)],w.prototype,"permissions",void 0),o([l.prop({default:1}),i("design:type",Number)],w.prototype,"tokenVersion",void 0),o([l.prop({default:1}),i("design:type",Number)],w.prototype,"passwordRecoveryVersion",void 0),o([l.prop({default:!1}),d.Field(),i("design:type",Boolean)],w.prototype,"verified",void 0),w=o([l.pre("save",(function(e){return r(this,void 0,void 0,(function*(){if(this.isNew){this.wasNew=this.isNew,this.password=yield u.default.hash(this.password,12);const e=yield c.roleModel.findOne({usedFor:"adminRole"},{id:1}),n=yield c.roleModel.findOne({usedFor:"baseRole"},{id:1});(yield t.userModel.estimatedDocumentCount())>0?this.role=f.default.Types.ObjectId(n._id):this.role=f.default.Types.ObjectId(e._id)}e()}))})),l.post("save",(function({_id:e,firstName:t,lastName:n,email:o,wasNew:i},a){return r(this,void 0,void 0,(function*(){try{if(i){const i=m.default.sign({id:e},v,{expiresIn:_}),r=new y.default({to:o,subject:"Verify your account",template:"welcome_email",data:{firstName:t,lastName:n,hash:i}});yield r.sendEmail()}a()}catch(e){throw new b.default(e)}}))})),s.ObjectType(),l.modelOptions({schemaOptions:{timestamps:!0}}),l.plugin(h.default)],w),t.User=w,t.userModel=l.getModelForClass(w)},function(e,t,n){"use strict";var o=this&&this.__decorate||function(e,t,n,o){var i,r=arguments.length,a=r<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(r<3?i(a):r>3?i(t,n,a):i(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a},i=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const a=n(0),s=n(2),l=r(n(8)),d=n(9),c=n(4),p=r(n(1)),u=n(6);let f=class extends d.Base{};o([a.Field(()=>a.ID),i("design:type",String)],f.prototype,"id",void 0),o([s.prop({required:!0,text:!0,index:!0}),a.Field({nullable:!1}),i("design:type",String)],f.prototype,"name",void 0),o([s.prop({required:!1}),a.Field({nullable:!0}),i("design:type",String)],f.prototype,"description",void 0),o([s.arrayProp({itemsRef:"Permission"}),a.Field(()=>[c.Permission],{nullable:!0}),i("design:type",Array)],f.prototype,"permissions",void 0),o([s.prop({required:!1,enum:[void 0,"adminRole","baseRole"]}),i("design:type",String)],f.prototype,"usedFor",void 0),f=o([s.pre("remove",(function(e){if(this.usedFor)return e(new p.default("Unable to delete the requested role"));if(u.userModel.findOne({role:this._id}))return e(new p.default("Unable to delete the requested role. It is currentyle assigned to one or more users."));e()})),a.ObjectType(),s.modelOptions({schemaOptions:{timestamps:!0}}),s.plugin(l.default)],f),t.Role=f,t.roleModel=s.getModelForClass(f)},function(e,t,n){"use strict";var o=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(i,r){function a(e){try{l(o.next(e))}catch(e){r(e)}}function s(e){try{l(o.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}l((o=o.apply(e,t||[])).next())}))};function i(e,t={select:{},sort:[],page:1,perPage:10}){return o(this,void 0,void 0,(function*(){let{select:n,sort:o,page:i,perPage:r}=t;const a=JSON.parse(JSON.stringify(e));e=e.length?a.reduce((e,t)=>(e[t.field]=new RegExp(`${t.value}`,"i"),e),{}):{};const s=JSON.parse(JSON.stringify(o));o=o.length?s.reduce((e,t)=>(e[t.field]=t.direction,e),{}):{};const l=(i-1)*r,d=yield this.countDocuments(e);return{docs:yield this.find(e).select(n).sort(o).skip(l).limit(r),total:d,pages:Math.ceil(d/r)||1,page:i,perPage:r}}))}Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){e.statics.paginate=i}},function(e,t,n){"use strict";var o=this&&this.__decorate||function(e,t,n,o){var i,r=arguments.length,a=r<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(r<3?i(a):r>3?i(t,n,a):i(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a},i=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0});const r=n(0),a=n(2),s=n(6);t.system={firstName:"System",lastName:"System",role:a.mongoose.Types.ObjectId(),permissions:[],id:"",email:"",password:"",wasNew:!1,verified:!0,tokenVersion:1,passwordRecoveryVersion:1,createdAt:"",updatedAt:"",createdBy:a.mongoose.Types.ObjectId(),lastUpdatedBy:a.mongoose.Types.ObjectId()};const l=n(12);let d=class{};o([a.prop(),r.Field({nullable:!1}),i("design:type",String)],d.prototype,"createdAt",void 0),o([a.prop(),r.Field({nullable:!1}),i("design:type",String)],d.prototype,"updatedAt",void 0),o([a.prop({required:!0}),r.Field(()=>s.User,{nullable:!1}),i("design:type",Object)],d.prototype,"createdBy",void 0),o([a.prop({required:!0}),r.Field(()=>s.User,{nullable:!1}),i("design:type",Object)],d.prototype,"lastUpdatedBy",void 0),d=o([a.pre("validate",(function(e){const n=l.get("req:user");return this.isNew?(this.createdBy=n?a.mongoose.Types.ObjectId(n._id):t.system,this.lastUpdatedBy=n?a.mongoose.Types.ObjectId(n._id):t.system,e()):(this.lastUpdatedBy=n?a.mongoose.Types.ObjectId(n._id):t.system,e())})),a.pre("save",(function(e){const n=l.get("req:user");return this.lastUpdatedBy=n?a.mongoose.Types.ObjectId(n._id):t.system,e()})),r.ObjectType()],d),t.Base=d},function(e,t,n){"use strict";var o=this&&this.__decorate||function(e,t,n,o){var i,r=arguments.length,a=r<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(r<3?i(a):r>3?i(t,n,a):i(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a},i=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},r=this&&this.__param||function(e,t){return function(n,o){t(n,o,e)}},a=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(i,r){function a(e){try{l(o.next(e))}catch(e){r(e)}}function s(e){try{l(o.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}l((o=o.apply(e,t||[])).next())}))},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const l=n(0),d=s(n(38)),c=n(6),p=n(5),u=n(39),f=s(n(41)),y=s(n(42)),m=n(3),h=s(n(1)),g=new m.Validator;t.default=function({prefix:e,returnType:t,model:n,allowedSearchCriterias:s,allowedSortCriterias:m,permissions:b}){e=e.toLowerCase(),b=Object.entries(b).reduce((e,t)=>(e[t[0]]=t[1].map(e=>e.toLowerCase()),e),{});const{findById:v=[],readAll:_=[],deleteById:w=[]}=b;let x=null,R=null;Object.keys(s).length&&(x=u.createDynamicFilterType(s,e)),Object.keys(m).length&&(R=u.createDynamicSortType(m,e));const O=f.default(x,R),E=y.default(e,t);let T=class{findById({id:t},{permissions:o,user:i}){return a(this,void 0,void 0,(function*(){try{const r={_id:t};o.includes(`read_all_${e}s`)||(r.createdBy=i._id);const a=yield n.findOne(r);if(!a)throw new h.default(`Unable to find a ${e} with the provided id`,404);return a}catch({message:e,code:t}){throw new h.default(e,t)}}))}readAll({perPage:t,page:o,filters:i=[],sort:r=[]},{permissions:a,user:s}){try{return a.includes(`read_all_${e}s`)||(i.createdBy={createdBy:s._id}),n.paginate(i,{page:o,perPage:t,sort:r})}catch({message:e,code:t}){throw new h.default(e,t)}}deleteById({id:t}){return a(this,void 0,void 0,(function*(){try{const o=yield n.findById(t);if(!o)throw new h.default(`The provided ${e} is invalid`,404);return yield o.remove(),!0}catch({message:e,code:t}){throw new h.default(e,t)}}))}createdBy(e){return a(this,void 0,void 0,(function*(){return g.isMongoId(e.createdBy)?c.userModel.findById(e.createdBy):e.createdBy}))}lastUpdatedBy(e){return a(this,void 0,void 0,(function*(){return g.isMongoId(e.lastUpdatedBy)?c.userModel.findById(e.lastUpdatedBy):e.lastUpdatedBy}))}};return o([l.Query(()=>t,{name:`${e}ById`}),l.Authorized(v),r(0,l.Args()),r(1,l.Ctx()),i("design:type",Function),i("design:paramtypes",[d.default,Object]),i("design:returntype",Promise)],T.prototype,"findById",null),o([l.Query(()=>E,{name:`${e}s`,nullable:!0}),l.Authorized(_),r(0,l.Args()),r(1,l.Ctx()),i("design:type",Function),i("design:paramtypes",[O,Object]),i("design:returntype",E)],T.prototype,"readAll",null),o([l.Mutation(()=>Boolean,{name:`delete${p.capitalize(e)}ById`}),l.Authorized(w),r(0,l.Args()),i("design:type",Function),i("design:paramtypes",[d.default]),i("design:returntype",Promise)],T.prototype,"deleteById",null),o([l.FieldResolver(()=>c.User,{name:"createdBy"}),r(0,l.Root()),i("design:type",Function),i("design:paramtypes",[Object]),i("design:returntype",Promise)],T.prototype,"createdBy",null),o([l.FieldResolver(()=>c.User,{name:"lastUpdatedBy"}),r(0,l.Root()),i("design:type",Function),i("design:paramtypes",[Object]),i("design:returntype",Promise)],T.prototype,"lastUpdatedBy",null),T=o([l.Resolver(()=>t,{isAbstract:!0})],T),T}},function(e,t,n){"use strict";var o=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(i,r){function a(e){try{l(o.next(e))}catch(e){r(e)}}function s(e){try{l(o.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}l((o=o.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const i=n(3),r=n(7),a=n(4),s=n(20);t.areMongoIds=function(e){return function(t,n){i.registerDecorator({target:t.constructor,propertyName:n,options:e,constraints:[],validator:{validate(e){try{if(!e.length)return!1;const t=new i.Validator;return e.every(e=>t.isMongoId(e))}catch(e){return!1}}}})}},t.areValidPermissions=function(e){return function(t,n){i.registerDecorator({target:t.constructor,propertyName:n,options:e,constraints:[],validator:{validate(e){return o(this,void 0,void 0,(function*(){try{if(!e.length)return!0;const t=new i.Validator;let n=e.every(e=>t.isMongoId(e));if(!n)return n;return(yield a.permissionModel.find({_id:{$in:n}},{_id:1})).length===e.length}catch(e){return!1}}))}}})}},t.isNewLead=function(e){return function(t,n){i.registerDecorator({target:t.constructor,propertyName:n,options:e,constraints:[],validator:{validate(e){return o(this,void 0,void 0,(function*(){try{return!(yield s.leadModel.findOne({email:e},{_id:1}))}catch(e){return!1}}))}}})}},t.nameNotTaken=function(e,t){return function(n,s){i.registerDecorator({target:n.constructor,propertyName:s,options:t,constraints:[],validator:{validate(t){return o(this,void 0,void 0,(function*(){try{let n;switch(e){case"role":n=yield r.roleModel.find({name:t});break;case"permission":n=yield a.permissionModel.find({name:t});break;default:return!1}return!Boolean(n.length)}catch(e){return!1}}))}}})}}},function(e,t){e.exports=require("request-context")},function(e,t,n){"use strict";var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=n(28),r=o(n(29)),a=n(14),s=n(5),l=o(n(1)),{welcomeEmail:d,passwordReset:c,newLead:p}=r.default,{EMAIL_PROVIDER_HOST:u,EMAIL_PROVIDER_USER:f,EMAIL_PROVIDER_PASS:y,EMAIL_PROVIDER_TLS_PORT:m,EMAIL_PROVIDER_SSL_PORT:h,DOMAIN:g,NODE_ENV:b,EMAIL_VERIFICATION_EXPIRY:v,PASSWORD_RESET_REQUEST_EXPIRY:_}=process.env,w={host:u,port:"production"===b?h:m,auth:{user:f,pass:y}};t.default=class{constructor({to:e,template:t,subject:n,data:o}){this.to=e,this.template=t,this.subject=n,this.data=o,this.transporter=i.createTransport(w)}chooseTemplate(e){switch(e){case"welcome_email":return d({firstName:this.data.firstName,lastName:this.data.lastName,hash:this.data.hash,expiry:s.legibleTime(v)});case"reset_password":return c({firstName:this.data.firstName,lastName:this.data.lastName,hash:this.data.hash,expiry:s.legibleTime(_)});case"new_lead":return p({data:this.data});default:throw new l.default("Invalid email template",500)}}sendEmail(){return new Promise((e,t)=>{const n={from:`do-not-reply@${g}${"production"===b?"":".com"}`,to:this.to,subject:this.subject,html:this.chooseTemplate(this.template)};this.transporter.sendMail(n,(n,o)=>{n&&t(n),console.log(a.cyan(JSON.stringify(o))),e()})})}}},function(e,t){e.exports=require("chalk")},function(e,t){e.exports=require("jsonwebtoken")},function(e,t){e.exports=require("dotenv/config")},function(e,t){e.exports=require("apollo-server-express")},function(e,t){e.exports=require("bcryptjs")},function(e,t){e.exports=require("graphql")},function(e,t,n){"use strict";var o=this&&this.__decorate||function(e,t,n,o){var i,r=arguments.length,a=r<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(r<3?i(a):r>3?i(t,n,a):i(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a},i=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const a=n(0),s=n(2),l=r(n(8)),d=n(9);let c=class extends d.Base{};o([s.prop({required:!1}),a.Field({nullable:!0}),i("design:type",String)],c.prototype,"name",void 0),o([s.prop({required:!1}),a.Field({nullable:!0}),i("design:type",String)],c.prototype,"phoneNumber",void 0),o([s.prop({required:!0}),a.Field({nullable:!1}),i("design:type",String)],c.prototype,"email",void 0),c=o([a.ObjectType(),s.plugin(l.default),s.modelOptions({schemaOptions:{timestamps:!0}})],c),t.Lead=c,t.leadModel=s.getModelForClass(c)},function(e,t,n){"use strict";var o=this&&this.__decorate||function(e,t,n,o){var i,r=arguments.length,a=r<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(r<3?i(a):r>3?i(t,n,a):i(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a},i=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0});const r=n(0),a=n(3),s=n(11);let l=class{};o([r.Field({nullable:!0}),i("design:type",String)],l.prototype,"name",void 0),o([r.Field({nullable:!0}),a.IsPhoneNumber("US",{message:"The provided phone number is invalid"}),i("design:type",String)],l.prototype,"phoneNumber",void 0),o([r.Field({nullable:!1}),a.IsEmail(void 0,{message:"The email provided is not valid"}),s.isNewLead({message:"We have already assesed your website, call us today for a free another free assesment."}),i("design:type",String)],l.prototype,"email",void 0),l=o([r.ArgsType()],l),t.default=l},function(e,t,n){"use strict";var o=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(i,r){function a(e){try{l(o.next(e))}catch(e){r(e)}}function s(e){try{l(o.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}l((o=o.apply(e,t||[])).next())}))},i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t},r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),n(23),n(16);const a=n(17),s=i(n(24)),l=n(0),d=r(n(25)),c=r(n(60)),p=n(2),u=r(n(61)),f=r(n(62)),y=r(n(63)),m=n(14),h=r(n(64)),g=r(n(1)),b=r(n(66)),v=n(12),{PORT:_,NODE_ENV:w,DB_USER:x,DB_PASS:R,DB_URI:O,ALLOWED_ORIGINS:E}=process.env;o(void 0,void 0,void 0,(function*(){try{const e=s.default();e.set("trust proxy",!0),e.use(v.middleware("req"));const t=yield l.buildSchema({resolvers:d.default,authChecker:c.default});"production"===w&&(e.use(s.json({limit:"2mb"})),e.use(f.default.HTTPS({trustProtoHeader:!0})),e.use(u.default()),e.disable("x-powered-by"),e.use(b.default({origin:(e,t)=>{throw JSON.parse(E).includes(e)&&t(null,!0),new g.default("The origin is not allowed",500)}}))),yield p.mongoose.connect(`mongodb+srv://${x}:${R}${O}`,{useNewUrlParser:!0,dbName:"forge",useUnifiedTopology:!0,useCreateIndex:!0,useFindAndModify:!1}),yield y.default(),new a.ApolloServer({context:({req:e,res:t})=>({req:e,res:t}),playground:"production"!==w,schema:t,debug:!1,plugins:[{requestDidStart:()=>({didResolveOperation({request:e,document:n}){h.default(e,n,t)}})}],formatError:e=>{var t;const n=e.message.toLowerCase();if(n.includes("argument validation error")){const t=e.extensions.exception.validationErrors.map(e=>e.constraints);e.message=t.map(e=>Object.values(e)),e.extensions.code="BAD_REQUEST"}else(n.includes("invalid signature")||n.includes("invalid token"))&&(e.message="Invalid request",e.extensions.code="BAD_REQUEST");return console.log(m.red(e.message),m.gray(null===(t=e.extensions)||void 0===t?void 0:t.code)),e}}).applyMiddleware({app:e}),e.listen(_,()=>console.log(m.cyan(`Server running on http://localhost:${_}/graphql`)))}catch({message:e,code:t}){throw console.log(m.red(e)),new g.default(e,t)}}))},function(e,t){e.exports=require("reflect-metadata")},function(e,t){e.exports=require("express")},function(e,t,n){"use strict";var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=o(n(26)),r=o(n(46)),a=o(n(49)),s=o(n(52)),l=o(n(55));t.default=[i.default,r.default,a.default,s.default,l.default]},function(e,t,n){"use strict";var o=this&&this.__decorate||function(e,t,n,o){var i,r=arguments.length,a=r<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(r<3?i(a):r>3?i(t,n,a):i(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a},i=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},r=this&&this.__param||function(e,t){return function(n,o){t(n,o,e)}},a=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(i,r){function a(e){try{l(o.next(e))}catch(e){r(e)}}function s(e){try{l(o.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}l((o=o.apply(e,t||[])).next())}))},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const l=n(0),d=n(6),c=s(n(33)),p=s(n(34)),u=s(n(35)),f=s(n(18)),y=s(n(15)),m=n(4),h=n(7),g=n(5),b=s(n(36)),v=s(n(37)),_=s(n(13)),w=s(n(10)),x=n(5),R=s(n(43)),O=s(n(1)),E=s(n(45)),T=n(2),{TOKEN_SECRET:j,REFRESH_TOKEN_SECRET:P,TOKEN_SECRET_EXPIRATION:S,REFRESH_TOKEN_SECRET_EXPIRATION:N,PASSWORD_RESET_REQUEST_EXPIRY:M,EMAIL_VERIFICATION_EXPIRY:I,GLOBAL_SECRET:A}=process.env,{textIndexes:F,regularIndexes:k}=x.createFilters(d.userModel,"User"),D=w.default({prefix:"User",returnType:d.User,model:d.userModel,allowedSearchCriterias:F,allowedSortCriterias:k,permissions:{findById:["read_all_Users"],readAll:["read_all_Users"],deleteById:["delete_all_Users"]}});let C=class extends D{me({user:e}){return e}resendVerificationEmail({email:e}){return a(this,void 0,void 0,(function*(){try{const t=yield d.userModel.findOne({email:e});if(!t)throw new O.default("The provided email is invalid",400);if(t.verified)throw new O.default("User is already verified",400);const n=y.default.sign({id:t._id},A,{expiresIn:I}),o=new _.default({to:e,subject:"Verify your account",template:"welcome_email",data:{firstName:t.firstName,lastName:t.lastName,hash:n}});return yield o.sendEmail(),!0}catch({message:e,code:t}){throw new O.default(e,t)}}))}login({email:e,password:t}){return a(this,void 0,void 0,(function*(){try{const n=yield d.userModel.findOne({email:e});if(!n)throw new O.default("The provided email or password is invalid",401);if(!(yield f.default.compare(t,n.password)))throw new O.default("The provided email or password is invalid",401);if(!n.verified)throw new O.default("The account has not yet been verified. Please check your email and verify your account.",403);const o={id:n._id,role:n.role,permissions:n.permissions,tokenVersion:n.tokenVersion},i=y.default.sign(o,j,{expiresIn:S}),r=y.default.sign(o,P,{expiresIn:N}),a=y.default.verify(r,P);return{token:i,refreshToken:r,refreshTokenExpiration:{createdAt:a.iat,expiresAt:a.exp}}}catch({message:e,code:t}){throw new O.default(e,t)}}))}refreshToken(e){return a(this,void 0,void 0,(function*(){try{const t=y.default.verify(e,process.env.REFRESH_TOKEN_SECRET),n=yield d.userModel.findById({_id:t.id});if(!n)throw new O.default("Invalid token",400);if(n.tokenVersion!==t.tokenVersion)throw new O.default("Invalid token",400);const o={id:n._id,role:n.role,permissions:n.permissions,tokenVersion:n.tokenVersion};return y.default.sign(o,j,{expiresIn:S})}catch({message:e,code:t}){throw new O.default(e,t)}}))}emailVerification(e){return a(this,void 0,void 0,(function*(){try{const t=y.default.verify(e,A);if(!t.id)throw new O.default("Invalid payload",400);let n=yield d.userModel.findById(t.id);if(!n)throw new O.default("The link is invalid or may have expired",403);if(n.verified)throw new O.default("The user has already been verified",400);return n.set({verified:!0}),yield n.save(),!0}catch({message:e,code:t}){throw new O.default(e,t)}}))}requestPasswordReset({email:e}){return a(this,void 0,void 0,(function*(){const t=yield d.userModel.findOne({email:e});if(!t)return!0;const n=y.default.sign({id:t._id,version:t.passwordRecoveryVersion},A,{expiresIn:M}),o=new _.default({template:"reset_password",subject:"Password Recovery",to:e,data:{hash:n,firstName:t.firstName,lastName:t.lastName}});return yield o.sendEmail(),!0}))}createUser({email:e,password:t,confirmPassword:n,firstName:o,lastName:i}){try{return g.createUser({email:e,password:t,confirmPassword:n,firstName:o,lastName:i})}catch({message:e,code:t}){throw new O.default(e,t)}}signUp({email:e,password:t,confirmPassword:n,firstName:o,lastName:i}){return a(this,void 0,void 0,(function*(){try{if(0===(yield d.userModel.estimatedDocumentCount()))throw new O.default("Unable to process your request",400);return g.createUser({email:e,password:t,confirmPassword:n,firstName:o,lastName:i})}catch({message:e,code:t}){throw new O.default(e,t)}}))}passwordReset({password:e,confirmPassword:t,hash:n}){return a(this,void 0,void 0,(function*(){try{if(e!==t)throw new O.default("Passwords provided do not match",400);const{id:o,version:i}=y.default.verify(n,A);if(!o)throw new O.default("The reset password link provided has been used or it has expired",403);const r=yield d.userModel.findById(o);if(!r)throw new O.default("Invalid request",400);if(i!==r.passwordRecoveryVersion)throw new O.default("The reset password link provided has been used or it has expired",403);const a=yield f.default.hash(e,12);return r.set({password:a,tokenVersion:r.tokenVersion+1,passwordRecoveryVersion:r.passwordRecoveryVersion+1}),yield r.save(),!0}catch({message:e,code:t}){throw new O.default(e,t)}}))}updateUser({id:e,firstName:t,lastName:n,newPermissions:o,role:i},{user:r,permissions:s}){return a(this,void 0,void 0,(function*(){try{const a={_id:e||r._id},l={};if(!s.includes("update_all_users")&&e!==r._id)throw new O.default("You do not have enough permissions to permform this action",403);const c=yield d.userModel.findOne(a);if(!c)throw new O.default("Unable to find a user with the provided Id",400);if(t&&(l.firstName=t),n&&(l.lastName=n),o.length){if((yield m.permissionModel.find({_id:{$in:o}},{_id:1})).length!==o.length)throw new O.default("You provided one or more invalid permission",400);l.permissions=o.map(e=>T.mongoose.Types.ObjectId(e))}if(i){if(!(yield h.roleModel.findById(i)))throw new O.default("You provided an invalid role",400);l.role=T.mongoose.Types.ObjectId(i)}return c.set(l),c.save()}catch({message:e,code:t}){throw new O.default(e,t)}}))}fullName(e){return`${e.firstName} ${e.lastName}`}role(e){return a(this,void 0,void 0,(function*(){try{const t=yield h.roleModel.findById(e.role);if(!t)throw new O.default("There was an error while processing your request",400);return t}catch({message:e,code:t}){throw new O.default(e,t)}}))}permissions(e){var t;return a(this,void 0,void 0,(function*(){try{const n=yield h.roleModel.findById(e.role,{permissions:1,_id:0});return yield m.permissionModel.find({$or:[{_id:{$in:null===(t=n)||void 0===t?void 0:t.permissions}},{_id:{$in:e.permissions}}]})}catch({message:e,code:t}){throw new O.default(e,t)}}))}};o([l.Query(()=>d.User),l.Authorized(),r(0,l.Ctx()),i("design:type",Function),i("design:paramtypes",[Object]),i("design:returntype",d.User)],C.prototype,"me",null),o([l.Query(()=>Boolean),r(0,l.Args()),i("design:type",Function),i("design:paramtypes",[v.default]),i("design:returntype",Promise)],C.prototype,"resendVerificationEmail",null),o([l.Query(()=>p.default),r(0,l.Args()),i("design:type",Function),i("design:paramtypes",[u.default]),i("design:returntype",Promise)],C.prototype,"login",null),o([l.Query(()=>String),r(0,l.Arg("refreshToken",{nullable:!1})),i("design:type",Function),i("design:paramtypes",[String]),i("design:returntype",Promise)],C.prototype,"refreshToken",null),o([l.Query(()=>Boolean),r(0,l.Arg("hash",{nullable:!1})),i("design:type",Function),i("design:paramtypes",[String]),i("design:returntype",Promise)],C.prototype,"emailVerification",null),o([l.Query(()=>Boolean),r(0,l.Args()),i("design:type",Function),i("design:paramtypes",[v.default]),i("design:returntype",Promise)],C.prototype,"requestPasswordReset",null),o([l.Mutation(()=>d.User),l.Authorized("create_users"),r(0,l.Args()),i("design:type",Function),i("design:paramtypes",[c.default]),i("design:returntype",Promise)],C.prototype,"createUser",null),o([l.Mutation(()=>d.User),R.default("login",30),r(0,l.Args()),i("design:type",Function),i("design:paramtypes",[c.default]),i("design:returntype",Promise)],C.prototype,"signUp",null),o([l.Mutation(()=>Boolean),r(0,l.Args()),i("design:type",Function),i("design:paramtypes",[b.default]),i("design:returntype",Promise)],C.prototype,"passwordReset",null),o([l.Mutation(()=>d.User),l.Authorized(["update_all_users","update_owned"]),r(0,l.Args()),r(1,l.Ctx()),i("design:type",Function),i("design:paramtypes",[E.default,Object]),i("design:returntype",Promise)],C.prototype,"updateUser",null),o([l.FieldResolver(()=>String),r(0,l.Root()),i("design:type",Function),i("design:paramtypes",[Object]),i("design:returntype",String)],C.prototype,"fullName",null),o([l.FieldResolver(()=>String),r(0,l.Root()),i("design:type",Function),i("design:paramtypes",[Object]),i("design:returntype",Promise)],C.prototype,"role",null),o([l.FieldResolver(()=>String),r(0,l.Root()),i("design:type",Function),i("design:paramtypes",[Object]),i("design:returntype",Promise)],C.prototype,"permissions",null),C=o([l.Resolver(()=>d.User)],C),t.default=C},function(e,t){e.exports=require("mongoose")},function(e,t){e.exports=require("nodemailer")},function(e,t,n){"use strict";var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=o(n(30)),r=o(n(31)),a=o(n(32));t.default={welcomeEmail:i.default,passwordReset:r.default,newLead:a.default}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const{PORT:o,DOMAIN:i,NODE_ENV:r}=process.env,a="production"===r?"https://":"http://",s="production"===r?"":`:${o}`;t.default=({firstName:e,lastName:t,hash:n,expiry:o})=>`\n<html>\n  <head>\n    <meta name="viewport" content="width=device-width" />\n    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />\n    <title>Simple Transactional Email</title>\n    <style>\n      /* -------------------------------------\n          GLOBAL RESETS\n      ------------------------------------- */\n      \n      /*All the styling goes here*/\n      \n      img {\n        border: none;\n        -ms-interpolation-mode: bicubic;\n        max-width: 100%; \n      }\n\n      body {\n        background-color: #f6f6f6;\n        font-family: sans-serif;\n        -webkit-font-smoothing: antialiased;\n        font-size: 14px;\n        line-height: 1.4;\n        margin: 0;\n        padding: 0;\n        -ms-text-size-adjust: 100%;\n        -webkit-text-size-adjust: 100%; \n      }\n\n      table {\n        border-collapse: separate;\n        mso-table-lspace: 0pt;\n        mso-table-rspace: 0pt;\n        width: 100%; }\n        table td {\n          font-family: sans-serif;\n          font-size: 14px;\n          vertical-align: top; \n      }\n\n      /* -------------------------------------\n          BODY & CONTAINER\n      ------------------------------------- */\n\n      .body {\n        background-color: #f6f6f6;\n        width: 100%; \n      }\n\n      /* Set a max-width, and make it display as block so it will automatically stretch to that width, but will also shrink down on a phone or something */\n      .container {\n        display: block;\n        margin: 0 auto !important;\n        /* makes it centered */\n        max-width: 580px;\n        padding: 10px;\n        width: 580px; \n      }\n\n      /* This should also be a block element, so that it will fill 100% of the .container */\n      .content {\n        box-sizing: border-box;\n        display: block;\n        margin: 0 auto;\n        max-width: 580px;\n        padding: 10px; \n      }\n\n      /* -------------------------------------\n          HEADER, FOOTER, MAIN\n      ------------------------------------- */\n      .main {\n        background: #ffffff;\n        border-radius: 3px;\n        width: 100%; \n      }\n\n      .wrapper {\n        box-sizing: border-box;\n        padding: 20px; \n      }\n\n      .content-block {\n        padding-bottom: 10px;\n        padding-top: 10px;\n      }\n\n      .footer {\n        clear: both;\n        margin-top: 10px;\n        text-align: center;\n        width: 100%; \n      }\n        .footer td,\n        .footer p,\n        .footer span,\n        .footer a {\n          color: #999999;\n          font-size: 12px;\n          text-align: center; \n      }\n\n      /* -------------------------------------\n          TYPOGRAPHY\n      ------------------------------------- */\n      h1,\n      h2,\n      h3,\n      h4 {\n        color: #000000;\n        font-family: sans-serif;\n        font-weight: 400;\n        line-height: 1.4;\n        margin: 0;\n        margin-bottom: 30px; \n      }\n\n      h1 {\n        font-size: 35px;\n        font-weight: 300;\n        text-align: center;\n        text-transform: capitalize; \n      }\n\n      p,\n      ul,\n      ol {\n        font-family: sans-serif;\n        font-size: 14px;\n        font-weight: normal;\n        margin: 0;\n        margin-bottom: 15px; \n      }\n        p li,\n        ul li,\n        ol li {\n          list-style-position: inside;\n          margin-left: 5px; \n      }\n\n      a {\n        color: #3498db;\n        text-decoration: underline; \n      }\n\n      /* -------------------------------------\n          BUTTONS\n      ------------------------------------- */\n      .btn {\n        box-sizing: border-box;\n        width: 100%; }\n        .btn > tbody > tr > td {\n          padding-bottom: 15px; }\n        .btn table {\n          width: auto; \n      }\n        .btn table td {\n          background-color: #ffffff;\n          border-radius: 5px;\n          text-align: center; \n      }\n        .btn a {\n          background-color: #ffffff;\n          border: solid 1px #3498db;\n          border-radius: 5px;\n          box-sizing: border-box;\n          color: #3498db;\n          cursor: pointer;\n          display: inline-block;\n          font-size: 14px;\n          font-weight: bold;\n          margin: 0;\n          padding: 12px 25px;\n          text-decoration: none;\n          text-transform: capitalize; \n      }\n\n      .btn-primary table td {\n        background-color: #3498db; \n      }\n\n      .btn-primary a {\n        background-color: #3498db;\n        border-color: #3498db;\n        color: #ffffff; \n      }\n\n      /* -------------------------------------\n          OTHER STYLES THAT MIGHT BE USEFUL\n      ------------------------------------- */\n      .last {\n        margin-bottom: 0; \n      }\n\n      .first {\n        margin-top: 0; \n      }\n\n      .align-center {\n        text-align: center; \n      }\n\n      .align-right {\n        text-align: right; \n      }\n\n      .align-left {\n        text-align: left; \n      }\n\n      .clear {\n        clear: both; \n      }\n\n      .mt0 {\n        margin-top: 0; \n      }\n\n      .mb0 {\n        margin-bottom: 0; \n      }\n\n      .preheader {\n        color: transparent;\n        display: none;\n        height: 0;\n        max-height: 0;\n        max-width: 0;\n        opacity: 0;\n        overflow: hidden;\n        mso-hide: all;\n        visibility: hidden;\n        width: 0; \n      }\n\n      .powered-by a {\n        text-decoration: none; \n      }\n\n      hr {\n        border: 0;\n        border-bottom: 1px solid #f6f6f6;\n        margin: 20px 0; \n      }\n\n      /* -------------------------------------\n          RESPONSIVE AND MOBILE FRIENDLY STYLES\n      ------------------------------------- */\n      @media only screen and (max-width: 620px) {\n        table[class=body] h1 {\n          font-size: 28px !important;\n          margin-bottom: 10px !important; \n        }\n        table[class=body] p,\n        table[class=body] ul,\n        table[class=body] ol,\n        table[class=body] td,\n        table[class=body] span,\n        table[class=body] a {\n          font-size: 16px !important; \n        }\n        table[class=body] .wrapper,\n        table[class=body] .article {\n          padding: 10px !important; \n        }\n        table[class=body] .content {\n          padding: 0 !important; \n        }\n        table[class=body] .container {\n          padding: 0 !important;\n          width: 100% !important; \n        }\n        table[class=body] .main {\n          border-left-width: 0 !important;\n          border-radius: 0 !important;\n          border-right-width: 0 !important; \n        }\n        table[class=body] .btn table {\n          width: 100% !important; \n        }\n        table[class=body] .btn a {\n          width: 100% !important; \n        }\n        table[class=body] .img-responsive {\n          height: auto !important;\n          max-width: 100% !important;\n          width: auto !important; \n        }\n      }\n\n      /* -------------------------------------\n          PRESERVE THESE STYLES IN THE HEAD\n      ------------------------------------- */\n      @media all {\n        .ExternalClass {\n          width: 100%; \n        }\n        .ExternalClass,\n        .ExternalClass p,\n        .ExternalClass span,\n        .ExternalClass font,\n        .ExternalClass td,\n        .ExternalClass div {\n          line-height: 100%; \n        }\n        .apple-link a {\n          color: inherit !important;\n          font-family: inherit !important;\n          font-size: inherit !important;\n          font-weight: inherit !important;\n          line-height: inherit !important;\n          text-decoration: none !important; \n        }\n        #MessageViewBody a {\n          color: inherit;\n          text-decoration: none;\n          font-size: inherit;\n          font-family: inherit;\n          font-weight: inherit;\n          line-height: inherit;\n        }\n        .btn-primary table td:hover {\n          background-color: #34495e !important; \n        }\n        .btn-primary a:hover {\n          background-color: #34495e !important;\n          border-color: #34495e !important; \n        } \n      }\n\n    </style>\n  </head>\n  <body class="">\n    <span class="preheader">Welcome!</span>\n    <table role="presentation" border="0" cellpadding="0" cellspacing="0" class="body">\n      <tr>\n        <td>&nbsp;</td>\n        <td class="container">\n          <div class="content">\n\n            \x3c!-- START CENTERED WHITE CONTAINER --\x3e\n            <table role="presentation" class="main">\n\n              \x3c!-- START MAIN CONTENT AREA --\x3e\n              <tr>\n                <td class="wrapper">\n                  <table role="presentation" border="0" cellpadding="0" cellspacing="0">\n                    <tr>\n                      <td>\n                        <p>Hi ${e} ${t},</p>\n                        <p>Your registration completed successfully! click the link below to verify your account. (the link below will be valid for ${o})</p>\n                        <table role="presentation" border="0" cellpadding="0" cellspacing="0" class="btn btn-primary">\n                          <tbody>\n                            <tr>\n                              <td align="left">\n                                <table role="presentation" border="0" cellpadding="0" cellspacing="0">\n                                  <tbody>\n                                    <tr>\n                                      <td> <a href="${a}${i}${s}/verify/${n}" target="_blank">Verify your account</a> </td>\n                                    </tr>\n                                  </tbody>\n                                </table>\n                              </td>\n                            </tr>\n                          </tbody>\n                        </table>\n                        <p>Tip: If the button above is not redirecting you, feel free to copy and paste the link below in a new browser window.</p>\n                        <p><a href="${a}${i}${s}/verify/${n}">${a}${i}${s}/verify/${n}</a></p>\n                      </td>\n                    </tr>\n                  </table>\n                </td>\n              </tr>\n\n            \x3c!-- END MAIN CONTENT AREA --\x3e\n            </table>\n            \x3c!-- END CENTERED WHITE CONTAINER --\x3e\n\n            \x3c!-- START FOOTER \n            <div class="footer">\n              <table role="presentation" border="0" cellpadding="0" cellspacing="0">\n                <tr>\n                  <td class="content-block">\n                    <span class="apple-link">Company Inc, 3 Abbey Road, San Francisco CA 94102</span>\n                    <br> Don't like these emails? <a href="http://i.imgur.com/CScmqnj.gif">Unsubscribe</a>.\n                  </td>\n                </tr>\n                <tr>\n                  <td class="content-block powered-by">\n                    Powered by <a href="http://htmlemail.io">HTMLemail</a>.\n                  </td>\n                </tr>\n              </table>\n            </div>\n          END FOOTER --\x3e\n\n          </div>\n        </td>\n        <td>&nbsp;</td>\n      </tr>\n    </table>\n  </body>\n</html>\n  `},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const{PORT:o,DOMAIN:i,NODE_ENV:r}=process.env,a="production"===r?"https://":"http://",s="production"===r?"":`:${o}`;t.default=({firstName:e,lastName:t,hash:n,expiry:o})=>`\n<html>\n  <head>\n    <meta name="viewport" content="width=device-width" />\n    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />\n    <title>Simple Transactional Email</title>\n    <style>\n      /* -------------------------------------\n          GLOBAL RESETS\n      ------------------------------------- */\n      \n      /*All the styling goes here*/\n      \n      img {\n        border: none;\n        -ms-interpolation-mode: bicubic;\n        max-width: 100%; \n      }\n\n      body {\n        background-color: #f6f6f6;\n        font-family: sans-serif;\n        -webkit-font-smoothing: antialiased;\n        font-size: 14px;\n        line-height: 1.4;\n        margin: 0;\n        padding: 0;\n        -ms-text-size-adjust: 100%;\n        -webkit-text-size-adjust: 100%; \n      }\n\n      table {\n        border-collapse: separate;\n        mso-table-lspace: 0pt;\n        mso-table-rspace: 0pt;\n        width: 100%; }\n        table td {\n          font-family: sans-serif;\n          font-size: 14px;\n          vertical-align: top; \n      }\n\n      /* -------------------------------------\n          BODY & CONTAINER\n      ------------------------------------- */\n\n      .body {\n        background-color: #f6f6f6;\n        width: 100%; \n      }\n\n      /* Set a max-width, and make it display as block so it will automatically stretch to that width, but will also shrink down on a phone or something */\n      .container {\n        display: block;\n        margin: 0 auto !important;\n        /* makes it centered */\n        max-width: 580px;\n        padding: 10px;\n        width: 580px; \n      }\n\n      /* This should also be a block element, so that it will fill 100% of the .container */\n      .content {\n        box-sizing: border-box;\n        display: block;\n        margin: 0 auto;\n        max-width: 580px;\n        padding: 10px; \n      }\n\n      /* -------------------------------------\n          HEADER, FOOTER, MAIN\n      ------------------------------------- */\n      .main {\n        background: #ffffff;\n        border-radius: 3px;\n        width: 100%; \n      }\n\n      .wrapper {\n        box-sizing: border-box;\n        padding: 20px; \n      }\n\n      .content-block {\n        padding-bottom: 10px;\n        padding-top: 10px;\n      }\n\n      .footer {\n        clear: both;\n        margin-top: 10px;\n        text-align: center;\n        width: 100%; \n      }\n        .footer td,\n        .footer p,\n        .footer span,\n        .footer a {\n          color: #999999;\n          font-size: 12px;\n          text-align: center; \n      }\n\n      /* -------------------------------------\n          TYPOGRAPHY\n      ------------------------------------- */\n      h1,\n      h2,\n      h3,\n      h4 {\n        color: #000000;\n        font-family: sans-serif;\n        font-weight: 400;\n        line-height: 1.4;\n        margin: 0;\n        margin-bottom: 30px; \n      }\n\n      h1 {\n        font-size: 35px;\n        font-weight: 300;\n        text-align: center;\n        text-transform: capitalize; \n      }\n\n      p,\n      ul,\n      ol {\n        font-family: sans-serif;\n        font-size: 14px;\n        font-weight: normal;\n        margin: 0;\n        margin-bottom: 15px; \n      }\n        p li,\n        ul li,\n        ol li {\n          list-style-position: inside;\n          margin-left: 5px; \n      }\n\n      a {\n        color: #3498db;\n        text-decoration: underline; \n      }\n\n      /* -------------------------------------\n          BUTTONS\n      ------------------------------------- */\n      .btn {\n        box-sizing: border-box;\n        width: 100%; }\n        .btn > tbody > tr > td {\n          padding-bottom: 15px; }\n        .btn table {\n          width: auto; \n      }\n        .btn table td {\n          background-color: #ffffff;\n          border-radius: 5px;\n          text-align: center; \n      }\n        .btn a {\n          background-color: #ffffff;\n          border: solid 1px #3498db;\n          border-radius: 5px;\n          box-sizing: border-box;\n          color: #3498db;\n          cursor: pointer;\n          display: inline-block;\n          font-size: 14px;\n          font-weight: bold;\n          margin: 0;\n          padding: 12px 25px;\n          text-decoration: none;\n          text-transform: capitalize; \n      }\n\n      .btn-primary table td {\n        background-color: #3498db; \n      }\n\n      .btn-primary a {\n        background-color: #3498db;\n        border-color: #3498db;\n        color: #ffffff; \n      }\n\n      /* -------------------------------------\n          OTHER STYLES THAT MIGHT BE USEFUL\n      ------------------------------------- */\n      .last {\n        margin-bottom: 0; \n      }\n\n      .first {\n        margin-top: 0; \n      }\n\n      .align-center {\n        text-align: center; \n      }\n\n      .align-right {\n        text-align: right; \n      }\n\n      .align-left {\n        text-align: left; \n      }\n\n      .clear {\n        clear: both; \n      }\n\n      .mt0 {\n        margin-top: 0; \n      }\n\n      .mb0 {\n        margin-bottom: 0; \n      }\n\n      .preheader {\n        color: transparent;\n        display: none;\n        height: 0;\n        max-height: 0;\n        max-width: 0;\n        opacity: 0;\n        overflow: hidden;\n        mso-hide: all;\n        visibility: hidden;\n        width: 0; \n      }\n\n      .powered-by a {\n        text-decoration: none; \n      }\n\n      hr {\n        border: 0;\n        border-bottom: 1px solid #f6f6f6;\n        margin: 20px 0; \n      }\n\n      /* -------------------------------------\n          RESPONSIVE AND MOBILE FRIENDLY STYLES\n      ------------------------------------- */\n      @media only screen and (max-width: 620px) {\n        table[class=body] h1 {\n          font-size: 28px !important;\n          margin-bottom: 10px !important; \n        }\n        table[class=body] p,\n        table[class=body] ul,\n        table[class=body] ol,\n        table[class=body] td,\n        table[class=body] span,\n        table[class=body] a {\n          font-size: 16px !important; \n        }\n        table[class=body] .wrapper,\n        table[class=body] .article {\n          padding: 10px !important; \n        }\n        table[class=body] .content {\n          padding: 0 !important; \n        }\n        table[class=body] .container {\n          padding: 0 !important;\n          width: 100% !important; \n        }\n        table[class=body] .main {\n          border-left-width: 0 !important;\n          border-radius: 0 !important;\n          border-right-width: 0 !important; \n        }\n        table[class=body] .btn table {\n          width: 100% !important; \n        }\n        table[class=body] .btn a {\n          width: 100% !important; \n        }\n        table[class=body] .img-responsive {\n          height: auto !important;\n          max-width: 100% !important;\n          width: auto !important; \n        }\n      }\n\n      /* -------------------------------------\n          PRESERVE THESE STYLES IN THE HEAD\n      ------------------------------------- */\n      @media all {\n        .ExternalClass {\n          width: 100%; \n        }\n        .ExternalClass,\n        .ExternalClass p,\n        .ExternalClass span,\n        .ExternalClass font,\n        .ExternalClass td,\n        .ExternalClass div {\n          line-height: 100%; \n        }\n        .apple-link a {\n          color: inherit !important;\n          font-family: inherit !important;\n          font-size: inherit !important;\n          font-weight: inherit !important;\n          line-height: inherit !important;\n          text-decoration: none !important; \n        }\n        #MessageViewBody a {\n          color: inherit;\n          text-decoration: none;\n          font-size: inherit;\n          font-family: inherit;\n          font-weight: inherit;\n          line-height: inherit;\n        }\n        .btn-primary table td:hover {\n          background-color: #34495e !important; \n        }\n        .btn-primary a:hover {\n          background-color: #34495e !important;\n          border-color: #34495e !important; \n        } \n      }\n\n    </style>\n  </head>\n  <body class="">\n    <span class="preheader">Password recovery</span>\n    <table role="presentation" border="0" cellpadding="0" cellspacing="0" class="body">\n      <tr>\n        <td>&nbsp;</td>\n        <td class="container">\n          <div class="content">\n\n            \x3c!-- START CENTERED WHITE CONTAINER --\x3e\n            <table role="presentation" class="main">\n\n              \x3c!-- START MAIN CONTENT AREA --\x3e\n              <tr>\n                <td class="wrapper">\n                  <table role="presentation" border="0" cellpadding="0" cellspacing="0">\n                    <tr>\n                      <td>\n                        <p>Hi ${e} ${t},</p>\n                        <p>We have received a password reset request. Follow the link below to reset your password. (the link below will be valid for ${o})</p>\n                        <table role="presentation" border="0" cellpadding="0" cellspacing="0" class="btn btn-primary">\n                          <tbody>\n                            <tr>\n                              <td align="left">\n                                <table role="presentation" border="0" cellpadding="0" cellspacing="0">\n                                  <tbody>\n                                    <tr>\n                                      <td> <a href="${a}${i}${s}/reset/${n}" target="_blank">Reset password</a> </td>\n                                    </tr>\n                                  </tbody>\n                                </table>\n                              </td>\n                            </tr>\n                          </tbody>\n                        </table>\n                        <p>Tip: If the button above is not redirecting you, feel free to copy and paste the link below in a new browser window.</p>\n                        <p><a href="${a}${i}${s}/reset/${n}">${a}${i}${s}/reset/${n}</a></p>\n                      </td>\n                    </tr>\n                  </table>\n                </td>\n              </tr>\n\n            \x3c!-- END MAIN CONTENT AREA --\x3e\n            </table>\n            \x3c!-- END CENTERED WHITE CONTAINER --\x3e\n\n            \x3c!-- START FOOTER \n            <div class="footer">\n              <table role="presentation" border="0" cellpadding="0" cellspacing="0">\n                <tr>\n                  <td class="content-block">\n                    <span class="apple-link">Company Inc, 3 Abbey Road, San Francisco CA 94102</span>\n                    <br> Don't like these emails? <a href="http://i.imgur.com/CScmqnj.gif">Unsubscribe</a>.\n                  </td>\n                </tr>\n                <tr>\n                  <td class="content-block powered-by">\n                    Powered by <a href="http://htmlemail.io">HTMLemail</a>.\n                  </td>\n                </tr>\n              </table>\n            </div>\n          END FOOTER --\x3e\n\n          </div>\n        </td>\n        <td>&nbsp;</td>\n      </tr>\n    </table>\n  </body>\n</html>\n  `},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=({data:e})=>`\n<html>\n  <head>\n    <meta name="viewport" content="width=device-width" />\n    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />\n    <title>Simple Transactional Email</title>\n    <style>\n      /* -------------------------------------\n          GLOBAL RESETS\n      ------------------------------------- */\n      \n      /*All the styling goes here*/\n      \n      img {\n        border: none;\n        -ms-interpolation-mode: bicubic;\n        max-width: 100%; \n      }\n\n      body {\n        background-color: #f6f6f6;\n        font-family: sans-serif;\n        -webkit-font-smoothing: antialiased;\n        font-size: 14px;\n        line-height: 1.4;\n        margin: 0;\n        padding: 0;\n        -ms-text-size-adjust: 100%;\n        -webkit-text-size-adjust: 100%; \n      }\n\n      table {\n        border-collapse: separate;\n        mso-table-lspace: 0pt;\n        mso-table-rspace: 0pt;\n        width: 100%; }\n        table td {\n          font-family: sans-serif;\n          font-size: 14px;\n          vertical-align: top; \n      }\n\n      /* -------------------------------------\n          BODY & CONTAINER\n      ------------------------------------- */\n\n      .body {\n        background-color: #f6f6f6;\n        width: 100%; \n      }\n\n      /* Set a max-width, and make it display as block so it will automatically stretch to that width, but will also shrink down on a phone or something */\n      .container {\n        display: block;\n        margin: 0 auto !important;\n        /* makes it centered */\n        max-width: 580px;\n        padding: 10px;\n        width: 580px; \n      }\n\n      /* This should also be a block element, so that it will fill 100% of the .container */\n      .content {\n        box-sizing: border-box;\n        display: block;\n        margin: 0 auto;\n        max-width: 580px;\n        padding: 10px; \n      }\n\n      /* -------------------------------------\n          HEADER, FOOTER, MAIN\n      ------------------------------------- */\n      .main {\n        background: #ffffff;\n        border-radius: 3px;\n        width: 100%; \n      }\n\n      .wrapper {\n        box-sizing: border-box;\n        padding: 20px; \n      }\n\n      .content-block {\n        padding-bottom: 10px;\n        padding-top: 10px;\n      }\n\n      .footer {\n        clear: both;\n        margin-top: 10px;\n        text-align: center;\n        width: 100%; \n      }\n        .footer td,\n        .footer p,\n        .footer span,\n        .footer a {\n          color: #999999;\n          font-size: 12px;\n          text-align: center; \n      }\n\n      /* -------------------------------------\n          TYPOGRAPHY\n      ------------------------------------- */\n      h1,\n      h2,\n      h3,\n      h4 {\n        color: #000000;\n        font-family: sans-serif;\n        font-weight: 400;\n        line-height: 1.4;\n        margin: 0;\n        margin-bottom: 30px; \n      }\n\n      h1 {\n        font-size: 35px;\n        font-weight: 300;\n        text-align: center;\n        text-transform: capitalize; \n      }\n\n      p,\n      ul,\n      ol {\n        font-family: sans-serif;\n        font-size: 14px;\n        font-weight: normal;\n        margin: 0;\n        margin-bottom: 15px; \n      }\n        p li,\n        ul li,\n        ol li {\n          list-style-position: inside;\n          margin-left: 5px; \n      }\n\n      a {\n        color: #3498db;\n        text-decoration: underline; \n      }\n\n      /* -------------------------------------\n          BUTTONS\n      ------------------------------------- */\n      .btn {\n        box-sizing: border-box;\n        width: 100%; }\n        .btn > tbody > tr > td {\n          padding-bottom: 15px; }\n        .btn table {\n          width: auto; \n      }\n        .btn table td {\n          background-color: #ffffff;\n          border-radius: 5px;\n          text-align: center; \n      }\n        .btn a {\n          background-color: #ffffff;\n          border: solid 1px #3498db;\n          border-radius: 5px;\n          box-sizing: border-box;\n          color: #3498db;\n          cursor: pointer;\n          display: inline-block;\n          font-size: 14px;\n          font-weight: bold;\n          margin: 0;\n          padding: 12px 25px;\n          text-decoration: none;\n          text-transform: capitalize; \n      }\n\n      .btn-primary table td {\n        background-color: #3498db; \n      }\n\n      .btn-primary a {\n        background-color: #3498db;\n        border-color: #3498db;\n        color: #ffffff; \n      }\n\n      /* -------------------------------------\n          OTHER STYLES THAT MIGHT BE USEFUL\n      ------------------------------------- */\n      .last {\n        margin-bottom: 0; \n      }\n\n      .first {\n        margin-top: 0; \n      }\n\n      .align-center {\n        text-align: center; \n      }\n\n      .align-right {\n        text-align: right; \n      }\n\n      .align-left {\n        text-align: left; \n      }\n\n      .clear {\n        clear: both; \n      }\n\n      .mt0 {\n        margin-top: 0; \n      }\n\n      .mb0 {\n        margin-bottom: 0; \n      }\n\n      .preheader {\n        color: transparent;\n        display: none;\n        height: 0;\n        max-height: 0;\n        max-width: 0;\n        opacity: 0;\n        overflow: hidden;\n        mso-hide: all;\n        visibility: hidden;\n        width: 0; \n      }\n\n      .powered-by a {\n        text-decoration: none; \n      }\n\n      hr {\n        border: 0;\n        border-bottom: 1px solid #f6f6f6;\n        margin: 20px 0; \n      }\n\n      /* -------------------------------------\n          RESPONSIVE AND MOBILE FRIENDLY STYLES\n      ------------------------------------- */\n      @media only screen and (max-width: 620px) {\n        table[class=body] h1 {\n          font-size: 28px !important;\n          margin-bottom: 10px !important; \n        }\n        table[class=body] p,\n        table[class=body] ul,\n        table[class=body] ol,\n        table[class=body] td,\n        table[class=body] span,\n        table[class=body] a {\n          font-size: 16px !important; \n        }\n        table[class=body] .wrapper,\n        table[class=body] .article {\n          padding: 10px !important; \n        }\n        table[class=body] .content {\n          padding: 0 !important; \n        }\n        table[class=body] .container {\n          padding: 0 !important;\n          width: 100% !important; \n        }\n        table[class=body] .main {\n          border-left-width: 0 !important;\n          border-radius: 0 !important;\n          border-right-width: 0 !important; \n        }\n        table[class=body] .btn table {\n          width: 100% !important; \n        }\n        table[class=body] .btn a {\n          width: 100% !important; \n        }\n        table[class=body] .img-responsive {\n          height: auto !important;\n          max-width: 100% !important;\n          width: auto !important; \n        }\n      }\n\n      /* -------------------------------------\n          PRESERVE THESE STYLES IN THE HEAD\n      ------------------------------------- */\n      @media all {\n        .ExternalClass {\n          width: 100%; \n        }\n        .ExternalClass,\n        .ExternalClass p,\n        .ExternalClass span,\n        .ExternalClass font,\n        .ExternalClass td,\n        .ExternalClass div {\n          line-height: 100%; \n        }\n        .apple-link a {\n          color: inherit !important;\n          font-family: inherit !important;\n          font-size: inherit !important;\n          font-weight: inherit !important;\n          line-height: inherit !important;\n          text-decoration: none !important; \n        }\n        #MessageViewBody a {\n          color: inherit;\n          text-decoration: none;\n          font-size: inherit;\n          font-family: inherit;\n          font-weight: inherit;\n          line-height: inherit;\n        }\n        .btn-primary table td:hover {\n          background-color: #34495e !important; \n        }\n        .btn-primary a:hover {\n          background-color: #34495e !important;\n          border-color: #34495e !important; \n        } \n      }\n\n    </style>\n  </head>\n  <body class="">\n    <span class="preheader">Welcome!</span>\n    <table role="presentation" border="0" cellpadding="0" cellspacing="0" class="body">\n      <tr>\n        <td>&nbsp;</td>\n        <td class="container">\n          <div class="content">\n\n            \x3c!-- START CENTERED WHITE CONTAINER --\x3e\n            <table role="presentation" class="main">\n\n              \x3c!-- START MAIN CONTENT AREA --\x3e\n              <tr>\n                <td class="wrapper">\n                  <table role="presentation" border="0" cellpadding="0" cellspacing="0">\n                    <tr>\n                      <td>\n                        <p>Hi team,</p>\n                        <p>There's a new lead coming from the website:</p>\n                        <table role="presentation" border="0" cellpadding="0" cellspacing="0" class="btn btn-primary">\n                          <tbody>\n                            <tr>\n                              <td align="left">\n                                <table role="presentation" border="0" cellpadding="0" cellspacing="0">\n                                  <tbody>\n                                    <tr>\n                                      <p>Name: ${e.name||"not provided"}</p>\n                                      <p>Phone number: ${e.phoneNumber||"not provided"}</p>\n                                      <p>Phone email: ${e.email||"not provided"}</p>\n                                    </tr>\n                                  </tbody>\n                                </table>\n                              </td>\n                            </tr>\n                          </tbody>\n                        </table>\n                      </td>\n                    </tr>\n                  </table>\n                </td>\n              </tr>\n\n            \x3c!-- END MAIN CONTENT AREA --\x3e\n            </table>\n            \x3c!-- END CENTERED WHITE CONTAINER --\x3e\n\n            \x3c!-- START FOOTER \n            <div class="footer">\n              <table role="presentation" border="0" cellpadding="0" cellspacing="0">\n                <tr>\n                  <td class="content-block">\n                    <span class="apple-link">Company Inc, 3 Abbey Road, San Francisco CA 94102</span>\n                    <br> Don't like these emails? <a href="http://i.imgur.com/CScmqnj.gif">Unsubscribe</a>.\n                  </td>\n                </tr>\n                <tr>\n                  <td class="content-block powered-by">\n                    Powered by <a href="http://htmlemail.io">HTMLemail</a>.\n                  </td>\n                </tr>\n              </table>\n            </div>\n          END FOOTER --\x3e\n\n          </div>\n        </td>\n        <td>&nbsp;</td>\n      </tr>\n    </table>\n  </body>\n</html>\n  `},function(e,t,n){"use strict";var o=this&&this.__decorate||function(e,t,n,o){var i,r=arguments.length,a=r<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(r<3?i(a):r>3?i(t,n,a):i(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a},i=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0});const r=n(0),a=n(3);let s=class{};o([r.Field({nullable:!1}),a.IsEmail(void 0,{message:"The provided email is invalid"}),i("design:type",String)],s.prototype,"email",void 0),o([r.Field({nullable:!1}),i("design:type",String)],s.prototype,"password",void 0),o([r.Field({nullable:!1}),i("design:type",String)],s.prototype,"confirmPassword",void 0),o([r.Field({nullable:!1}),i("design:type",String)],s.prototype,"firstName",void 0),o([r.Field({nullable:!1}),i("design:type",String)],s.prototype,"lastName",void 0),s=o([r.ArgsType()],s),t.default=s},function(e,t,n){"use strict";var o=this&&this.__decorate||function(e,t,n,o){var i,r=arguments.length,a=r<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(r<3?i(a):r>3?i(t,n,a):i(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a},i=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0});const r=n(0);let a=class{};o([r.Field({nullable:!1}),i("design:type",Number)],a.prototype,"createdAt",void 0),o([r.Field({nullable:!1}),i("design:type",Number)],a.prototype,"expiresAt",void 0),a=o([r.ObjectType()],a);let s=class{};o([r.Field(()=>String,{nullable:!1}),i("design:type",String)],s.prototype,"token",void 0),o([r.Field(()=>a,{nullable:!1}),i("design:type",a)],s.prototype,"refreshTokenExpiration",void 0),o([r.Field(()=>String,{nullable:!1}),i("design:type",String)],s.prototype,"refreshToken",void 0),s=o([r.ObjectType()],s),t.default=s},function(e,t,n){"use strict";var o=this&&this.__decorate||function(e,t,n,o){var i,r=arguments.length,a=r<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(r<3?i(a):r>3?i(t,n,a):i(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a},i=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0});const r=n(0),a=n(3);let s=class{};o([r.Field({nullable:!1}),a.IsEmail(void 0,{message:"The provided email is invalid"}),i("design:type",String)],s.prototype,"email",void 0),o([r.Field({nullable:!1}),i("design:type",String)],s.prototype,"password",void 0),s=o([r.ArgsType()],s),t.default=s},function(e,t,n){"use strict";var o=this&&this.__decorate||function(e,t,n,o){var i,r=arguments.length,a=r<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(r<3?i(a):r>3?i(t,n,a):i(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a},i=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0});const r=n(0);let a=class{};o([r.Field({nullable:!1}),i("design:type",String)],a.prototype,"password",void 0),o([r.Field({nullable:!1}),i("design:type",String)],a.prototype,"confirmPassword",void 0),o([r.Field({nullable:!1}),i("design:type",String)],a.prototype,"hash",void 0),a=o([r.ArgsType()],a),t.default=a},function(e,t,n){"use strict";var o=this&&this.__decorate||function(e,t,n,o){var i,r=arguments.length,a=r<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(r<3?i(a):r>3?i(t,n,a):i(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a},i=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0});const r=n(0),a=n(3);let s=class{};o([r.Field({nullable:!1}),a.IsEmail(void 0,{message:"The provided email is invalid"}),i("design:type",String)],s.prototype,"email",void 0),s=o([r.ArgsType()],s),t.default=s},function(e,t,n){"use strict";var o=this&&this.__decorate||function(e,t,n,o){var i,r=arguments.length,a=r<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(r<3?i(a):r>3?i(t,n,a):i(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a},i=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0});const r=n(0),a=n(3);let s=class{};o([r.Field({nullable:!1}),a.IsMongoId({message:"The provided ID is invalid"}),i("design:type",String)],s.prototype,"id",void 0),s=o([r.ArgsType()],s),t.default=s},function(e,t,n){"use strict";var o=this&&this.__decorate||function(e,t,n,o){var i,r=arguments.length,a=r<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(r<3?i(a):r>3?i(t,n,a):i(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a},i=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0});const r=n(0),a=n(40);var s;!function(e){e[e.ASCENDING=1]="ASCENDING",e[e.DESCENDING=-1]="DESCENDING"}(s||(s={})),r.registerEnumType(s,{name:"direction"}),t.createDynamicFilterType=function(e,t){let n=class{};return o([r.Field(()=>e,{nullable:!1}),i("design:type",Object)],n.prototype,"field",void 0),o([r.Field(()=>a.intOrStringScalar,{nullable:!1}),i("design:type",Object)],n.prototype,"value",void 0),n=o([r.InputType(`${t}Filter`)],n),n},t.createDynamicSortType=function(e,t){let n=class{};return o([r.Field(()=>e,{nullable:!1}),i("design:type",Object)],n.prototype,"field",void 0),o([r.Field(()=>s,{nullable:!1}),i("design:type",Number)],n.prototype,"direction",void 0),n=o([r.InputType(`${t}Sort`)],n),n}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const o=n(19);t.intOrStringScalar=new o.GraphQLScalarType({name:"IntOrStr",description:"A custom scalar that accepts int or string values",parseValue:e=>e,serialize:e=>e,parseLiteral:e=>e.kind===o.Kind.STRING||e.kind===o.Kind.INT?e.value:null})},function(e,t,n){"use strict";var o=this&&this.__decorate||function(e,t,n,o){var i,r=arguments.length,a=r<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(r<3?i(a):r>3?i(t,n,a):i(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a},i=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0});const r=n(0),a=n(3);t.default=function(e,t){let n=class{};if(o([r.Field({nullable:!0,defaultValue:10}),a.IsOptional(),a.Min(1,{message:"The per page param must be between 1 and 25"}),a.Max(25,{message:"The per page param must be between 1 and 25"}),i("design:type",Number)],n.prototype,"perPage",void 0),o([r.Field({nullable:!0,defaultValue:1}),i("design:type",Number)],n.prototype,"page",void 0),n=o([r.ArgsType()],n),e&&!t){let t=class extends n{};return o([r.Field(()=>[e],{nullable:!0,defaultValue:[]}),i("design:type",Array)],t.prototype,"filters",void 0),t=o([r.ArgsType()],t),t}if(t&&!e){let e=class extends n{};return o([r.Field(()=>[t],{nullable:!0,defaultValue:[]}),i("design:type",Array)],e.prototype,"sort",void 0),e=o([r.ArgsType()],e),e}if(t&&e){let a=class extends n{};return o([r.Field(()=>[t],{nullable:!0,defaultValue:[]}),i("design:type",Array)],a.prototype,"sort",void 0),o([r.Field(()=>[e],{nullable:!0,defaultValue:[]}),i("design:type",Array)],a.prototype,"filters",void 0),a=o([r.ArgsType()],a),a}return n}},function(e,t,n){"use strict";var o=this&&this.__decorate||function(e,t,n,o){var i,r=arguments.length,a=r<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(r<3?i(a):r>3?i(t,n,a):i(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a},i=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0});const r=n(0);t.default=function(e,t){let n=class{};return o([r.Field(()=>[t],{nullable:!0}),i("design:type",Array)],n.prototype,"docs",void 0),o([r.Field(),i("design:type",Number)],n.prototype,"total",void 0),o([r.Field(),i("design:type",Number)],n.prototype,"perPage",void 0),o([r.Field(),i("design:type",Number)],n.prototype,"page",void 0),o([r.Field(),i("design:type",Number)],n.prototype,"pages",void 0),n=o([r.ObjectType(`${e}PaginationOutput`)],n),n}},function(e,t,n){"use strict";var o=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(i,r){function a(e){try{l(o.next(e))}catch(e){r(e)}}function s(e){try{l(o.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}l((o=o.apply(e,t||[])).next())}))},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=n(0),a=n(44),s=i(n(1));t.default=function(e,t){return r.createMethodDecorator(({context:n},i)=>o(this,void 0,void 0,(function*(){const o=n,{req:{ip:r}}=o,l=yield a.ipModel.findOne({ip:r,offense:e});if(!l)return yield a.ipModel.create({ip:r,offense:e,times:1}),i();if(l.times>=t)throw new s.default("Unable to process your request. Try again later",429);return l.set({times:l.times+1}),yield l.save(),i()})))}},function(e,t,n){"use strict";var o=this&&this.__decorate||function(e,t,n,o){var i,r=arguments.length,a=r<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(r<3?i(a):r>3?i(t,n,a):i(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a},i=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0});const r=n(2),{OFFENSE_EXPIRY:a}=process.env;let s=class{};o([r.prop({required:!0,index:!0}),i("design:type",String)],s.prototype,"ip",void 0),o([r.prop({required:!0,lowercase:!0}),i("design:type",String)],s.prototype,"offense",void 0),o([r.prop({default:0}),i("design:type",Number)],s.prototype,"times",void 0),o([r.prop({expires:a}),i("design:type",Date)],s.prototype,"createdAt",void 0),s=o([r.modelOptions({schemaOptions:{timestamps:!0}})],s),t.Ip=s,t.ipModel=r.getModelForClass(s)},function(e,t,n){"use strict";var o=this&&this.__decorate||function(e,t,n,o){var i,r=arguments.length,a=r<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(r<3?i(a):r>3?i(t,n,a):i(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a},i=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0});const r=n(0),a=n(3),s=n(11);let l=class{};o([r.Field({nullable:!0}),i("design:type",String)],l.prototype,"id",void 0),o([r.Field({nullable:!0}),i("design:type",String)],l.prototype,"firstName",void 0),o([r.Field({nullable:!0}),i("design:type",String)],l.prototype,"lastName",void 0),o([r.Field({nullable:!0}),a.IsMongoId({message:"The provided role Id is invalid"}),i("design:type",String)],l.prototype,"role",void 0),o([r.Field(()=>[String],{nullable:!0}),s.areMongoIds({message:"One or more of the provided permissions Id is invalid"}),i("design:type",Array)],l.prototype,"newPermissions",void 0),l=o([r.ArgsType()],l),t.default=l},function(e,t,n){"use strict";var o=this&&this.__decorate||function(e,t,n,o){var i,r=arguments.length,a=r<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(r<3?i(a):r>3?i(t,n,a):i(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a},i=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},r=this&&this.__param||function(e,t){return function(n,o){t(n,o,e)}},a=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(i,r){function a(e){try{l(o.next(e))}catch(e){r(e)}}function s(e){try{l(o.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}l((o=o.apply(e,t||[])).next())}))},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const l=n(0),d=n(7),c=s(n(47)),p=s(n(10)),u=n(5),f=s(n(1)),y=s(n(48)),m=n(4),h=n(2),{textIndexes:g,regularIndexes:b}=u.createFilters(d.roleModel,"Role"),v=p.default({prefix:"Role",returnType:d.Role,model:d.roleModel,allowedSearchCriterias:g,allowedSortCriterias:b,permissions:{findById:["read_all_Roles","read_owned"],readAll:["read_all_Roles","read_owned"],deleteById:["delete_all_Roles","delete_owned"]}});let _=class extends v{createRole({name:e,permissions:t}){try{return d.roleModel.create({name:e,permissions:t})}catch({message:e,code:t}){throw new f.default(e,t)}}updateRole({id:e,name:t,description:n,newPermissions:o},{permissions:i,user:r}){return a(this,void 0,void 0,(function*(){try{const a={_id:e},s={};i.includes("update_all_roles")||(a.createdBy=r._id);const l=yield d.roleModel.findOne(a);if(!l)throw new f.default("Unable to find a role with the provided id",400);if(t&&(s.name=t),n&&(s.description=n),o.length){if((yield m.permissionModel.find({_id:{$in:o}},{_id:1})).length!==o.length)throw new f.default("You provided one or more invalid permission",400);s.permissions=o.map(e=>h.mongoose.Types.ObjectId(e))}return l.set(s),l.save()}catch({message:e,code:t}){throw new f.default(e,t)}}))}permissions(e){return a(this,void 0,void 0,(function*(){try{const t=yield m.permissionModel.find({_id:{$in:e.permissions}});if(!t)throw new f.default("There was an error while processing your request",400);return t}catch({message:e,code:t}){throw new f.default(e,t)}}))}};o([l.Mutation(()=>d.Role),l.Authorized(["create_roles"]),r(0,l.Args()),i("design:type",Function),i("design:paramtypes",[c.default]),i("design:returntype",Promise)],_.prototype,"createRole",null),o([l.Mutation(()=>d.Role),l.Authorized(["update_all_roles"]),r(0,l.Args()),r(1,l.Ctx()),i("design:type",Function),i("design:paramtypes",[y.default,Object]),i("design:returntype",Promise)],_.prototype,"updateRole",null),o([l.FieldResolver(()=>[m.Permission]),r(0,l.Root()),i("design:type",Function),i("design:paramtypes",[Object]),i("design:returntype",Promise)],_.prototype,"permissions",null),_=o([l.Resolver(()=>d.Role)],_),t.default=_},function(e,t,n){"use strict";var o=this&&this.__decorate||function(e,t,n,o){var i,r=arguments.length,a=r<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(r<3?i(a):r>3?i(t,n,a):i(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a},i=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0});const r=n(0),a=n(11);let s=class{};o([r.Field({nullable:!1}),a.nameNotTaken("role",{message:"That role name already exists"}),i("design:type",String)],s.prototype,"name",void 0),o([r.Field(()=>[String],{nullable:!0}),a.areValidPermissions({message:"One or more of the provided permissions is invalid"}),i("design:type",Array)],s.prototype,"permissions",void 0),s=o([r.ArgsType()],s),t.default=s},function(e,t,n){"use strict";var o=this&&this.__decorate||function(e,t,n,o){var i,r=arguments.length,a=r<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(r<3?i(a):r>3?i(t,n,a):i(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a},i=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0});const r=n(0),a=n(3),s=n(11);let l=class{};o([r.Field({nullable:!0}),i("design:type",String)],l.prototype,"name",void 0),o([r.Field({nullable:!1}),a.IsMongoId({message:"The provided id is invalid"}),i("design:type",String)],l.prototype,"id",void 0),o([r.Field({nullable:!0}),i("design:type",String)],l.prototype,"description",void 0),o([r.Field(()=>[String],{nullable:!0}),s.areMongoIds({message:"One or more of the permissions id is invalid"}),i("design:type",Array)],l.prototype,"newPermissions",void 0),l=o([r.ArgsType()],l),t.default=l},function(e,t,n){"use strict";var o=this&&this.__decorate||function(e,t,n,o){var i,r=arguments.length,a=r<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(r<3?i(a):r>3?i(t,n,a):i(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a},i=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},r=this&&this.__param||function(e,t){return function(n,o){t(n,o,e)}},a=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(i,r){function a(e){try{l(o.next(e))}catch(e){r(e)}}function s(e){try{l(o.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}l((o=o.apply(e,t||[])).next())}))},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const l=n(0),d=n(4),c=s(n(50)),p=s(n(10)),u=n(5),f=s(n(1)),y=s(n(51)),{textIndexes:m,regularIndexes:h}=u.createFilters(d.permissionModel,"Permission"),g=p.default({prefix:"Permission",returnType:d.Permission,model:d.permissionModel,allowedSearchCriterias:m,allowedSortCriterias:h,permissions:{findById:["read_all_Permissions","read_owned"],readAll:["read_all_Permissions","read_owned"],deleteById:["delete_all_Permissions","delete_owned"]}});let b=class extends g{createPermission({name:e,description:t}){return a(this,void 0,void 0,(function*(){return d.permissionModel.create({name:e,description:t})}))}updatePermission({id:e,name:t,description:n},{permissions:o,user:i}){return a(this,void 0,void 0,(function*(){try{const r={_id:e},a={};o.includes("update_all_permissions")||(r.createdBy=i._id);const s=yield d.permissionModel.findOne(r);if(!s)throw new f.default("Unable to find a permission with the provided id",400);return t&&(a.name=t),n&&(a.description=n),s.set(a),s.save()}catch({message:e,code:t}){throw new f.default(e,t)}}))}};o([l.Mutation(()=>d.Permission),l.Authorized(["create_permissions"]),r(0,l.Args()),i("design:type",Function),i("design:paramtypes",[c.default]),i("design:returntype",Promise)],b.prototype,"createPermission",null),o([l.Mutation(()=>d.Permission),l.Authorized(["update_all_permissions"]),r(0,l.Args()),r(1,l.Ctx()),i("design:type",Function),i("design:paramtypes",[y.default,Object]),i("design:returntype",Promise)],b.prototype,"updatePermission",null),b=o([l.Resolver(()=>d.Permission)],b),t.default=b},function(e,t,n){"use strict";var o=this&&this.__decorate||function(e,t,n,o){var i,r=arguments.length,a=r<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(r<3?i(a):r>3?i(t,n,a):i(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a},i=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0});const r=n(0),a=n(11);let s=class{};o([r.Field({nullable:!1}),a.nameNotTaken("permission",{message:"That permission name already exists"}),i("design:type",String)],s.prototype,"name",void 0),o([r.Field({nullable:!0}),i("design:type",String)],s.prototype,"description",void 0),s=o([r.ArgsType()],s),t.default=s},function(e,t,n){"use strict";var o=this&&this.__decorate||function(e,t,n,o){var i,r=arguments.length,a=r<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(r<3?i(a):r>3?i(t,n,a):i(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a},i=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0});const r=n(0),a=n(3);let s=class{};o([r.Field({nullable:!1}),a.IsMongoId({message:"The provided permission Id is invalid"}),i("design:type",String)],s.prototype,"id",void 0),o([r.Field({nullable:!0}),i("design:type",String)],s.prototype,"name",void 0),o([r.Field({nullable:!0}),i("design:type",String)],s.prototype,"description",void 0),s=o([r.ArgsType()],s),t.default=s},function(e,t,n){"use strict";var o=this&&this.__decorate||function(e,t,n,o){var i,r=arguments.length,a=r<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(r<3?i(a):r>3?i(t,n,a):i(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a},i=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},r=this&&this.__param||function(e,t){return function(n,o){t(n,o,e)}},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=n(0),l=n(53),d=a(n(54)),c=n(5),p=a(n(10)),{textIndexes:u,regularIndexes:f}=c.createFilters(l.tipModel,"Tip"),y=p.default({prefix:"Tip",returnType:l.Tip,model:l.tipModel,allowedSearchCriterias:u,allowedSortCriterias:f,permissions:{findById:["read_all_Tips"],readAll:["read_all_Tips"],deleteById:["delete_all_Tips"]}});let m=class extends y{createTip({title:e,description:t,department:n}){return l.tipModel.create({title:e,description:t,department:n})}};o([s.Mutation(()=>l.Tip),r(0,s.Args()),i("design:type",Function),i("design:paramtypes",[d.default]),i("design:returntype",Promise)],m.prototype,"createTip",null),m=o([s.Resolver(()=>l.Tip)],m),t.default=m},function(e,t,n){"use strict";var o=this&&this.__decorate||function(e,t,n,o){var i,r=arguments.length,a=r<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(r<3?i(a):r>3?i(t,n,a):i(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a},i=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const a=n(0),s=n(9),l=n(2),d=r(n(8));let c=class extends s.Base{};o([l.prop({required:!0}),a.Field({nullable:!1}),i("design:type",String)],c.prototype,"description",void 0),o([l.prop({required:!0}),a.Field({nullable:!1}),i("design:type",String)],c.prototype,"title",void 0),o([l.prop({required:!0}),a.Field({nullable:!1}),i("design:type",String)],c.prototype,"department",void 0),c=o([l.modelOptions({schemaOptions:{timestamps:!0}}),l.plugin(d.default),a.ObjectType()],c),t.Tip=c,t.tipModel=l.getModelForClass(c)},function(e,t,n){"use strict";var o=this&&this.__decorate||function(e,t,n,o){var i,r=arguments.length,a=r<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(r<3?i(a):r>3?i(t,n,a):i(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a},i=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0});const r=n(0);var a;!function(e){e.SEO="seo",e.PPC="ppc"}(a||(a={})),r.registerEnumType(a,{name:"departments"});let s=class{};o([r.Field({nullable:!1}),i("design:type",String)],s.prototype,"title",void 0),o([r.Field({nullable:!1}),i("design:type",String)],s.prototype,"description",void 0),o([r.Field(()=>a,{nullable:!1}),i("design:type",String)],s.prototype,"department",void 0),s=o([r.ArgsType()],s),t.default=s},function(e,t,n){"use strict";var o=this&&this.__decorate||function(e,t,n,o){var i,r=arguments.length,a=r<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(r<3?i(a):r>3?i(t,n,a):i(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a},i=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},r=this&&this.__param||function(e,t){return function(n,o){t(n,o,e)}},a=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(i,r){function a(e){try{l(o.next(e))}catch(e){r(e)}}function s(e){try{l(o.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}l((o=o.apply(e,t||[])).next())}))},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const l=n(0),d=n(20),c=s(n(21)),p=s(n(13)),u=n(5),f=s(n(10)),y=s(n(56)),m=s(n(57)),h=s(n(59)),{textIndexes:g,regularIndexes:b}=u.createFilters(d.leadModel,"Lead"),v=f.default({prefix:"Lead",returnType:d.Lead,model:d.leadModel,allowedSearchCriterias:g,allowedSortCriterias:b,permissions:{findById:["read_all_Leads"],readAll:["read_all_Leads"],deleteById:["delete_all_Leads"]}});let _=class extends v{createLead({phoneNumber:e,name:t,email:n}){return a(this,void 0,void 0,(function*(){const o=yield d.leadModel.create({email:n,phoneNumber:e,name:t}),i=new p.default({subject:"New Lead",to:JSON.parse(process.env.LEAD_RECIPIENTS),data:o,template:"new_lead"});return yield i.sendEmail(),o}))}checkSEO({url:e,phoneNumber:t,email:n,name:o}){return a(this,void 0,void 0,(function*(){const i=yield d.leadModel.create({email:n,phoneNumber:t,name:o}),r=new p.default({subject:"New Lead",to:JSON.parse(process.env.LEAD_RECIPIENTS),data:i,template:"new_lead"});yield r.sendEmail();const a=new m.default({url:e});return yield a.checkSEO()}))}};o([l.Mutation(()=>d.Lead),r(0,l.Args()),i("design:type",Function),i("design:paramtypes",[c.default]),i("design:returntype",Promise)],_.prototype,"createLead",null),o([l.Mutation(()=>h.default),r(0,l.Args()),i("design:type",Function),i("design:paramtypes",[y.default]),i("design:returntype",Promise)],_.prototype,"checkSEO",null),_=o([l.Resolver(()=>d.Lead)],_),t.default=_},function(e,t,n){"use strict";var o=this&&this.__decorate||function(e,t,n,o){var i,r=arguments.length,a=r<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(r<3?i(a):r>3?i(t,n,a):i(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a},i=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const a=n(0),s=r(n(21));let l=class extends s.default{};o([a.Field({nullable:!1}),i("design:type",String)],l.prototype,"url",void 0),l=o([a.ArgsType()],l),t.default=l},function(e,t,n){"use strict";var o=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(i,r){function a(e){try{l(o.next(e))}catch(e){r(e)}}function s(e){try{l(o.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}l((o=o.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const i=n(58);t.default=class{constructor({url:e=""}){this.url=e}checkSEO(){return o(this,void 0,void 0,(function*(){const e=i(this.url,{});return new Promise((t,n)=>{e.analyze([this.url]).then(e=>{e.pages[0]||n("We were not able to collect data from your website");const o=e.pages[0];t(o)})})}))}}},function(e,t){e.exports=require("advanced-seo-checker")},function(e,t,n){"use strict";var o=this&&this.__decorate||function(e,t,n,o){var i,r=arguments.length,a=r<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(r<3?i(a):r>3?i(t,n,a):i(t,n))||a);return r>3&&a&&Object.defineProperty(t,n,a),a},i=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0});const r=n(0);let a=class{};o([r.Field(()=>[String]),i("design:type",Array)],a.prototype,"h1",void 0),o([r.Field(()=>[String]),i("design:type",Array)],a.prototype,"h2",void 0),o([r.Field(()=>[String]),i("design:type",Array)],a.prototype,"h3",void 0),o([r.Field(()=>[String]),i("design:type",Array)],a.prototype,"h4",void 0),o([r.Field(()=>[String]),i("design:type",Array)],a.prototype,"h5",void 0),o([r.Field(()=>[String]),i("design:type",Array)],a.prototype,"h6",void 0),a=o([r.ObjectType()],a);let s=class{};o([r.Field(),i("design:type",Number)],s.prototype,"score",void 0),s=o([r.ObjectType()],s);let l=class extends s{};l=o([r.ObjectType()],l);let d=class extends s{};d=o([r.ObjectType()],d);let c=class{};o([r.Field(),i("design:type",s)],c.prototype,"performance",void 0),o([r.Field(),i("design:type",l)],c.prototype,"accessibility",void 0),o([r.Field(),i("design:type",d)],c.prototype,"seo",void 0),c=o([r.ObjectType()],c);let p=class{};o([r.Field(),i("design:type",String)],p.prototype,"url",void 0),o([r.Field(),i("design:type",String)],p.prototype,"title",void 0),o([r.Field(()=>a),i("design:type",a)],p.prototype,"headers",void 0),o([r.Field(),i("design:type",String)],p.prototype,"description",void 0),o([r.Field(),i("design:type",String)],p.prototype,"isMobileFriendly",void 0),o([r.Field(),i("design:type",c)],p.prototype,"scores",void 0),p=o([r.ObjectType()],p),t.default=p},function(e,t,n){"use strict";var o=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(i,r){function a(e){try{l(o.next(e))}catch(e){r(e)}}function s(e){try{l(o.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}l((o=o.apply(e,t||[])).next())}))},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=i(n(15));n(16);const a=n(6),s=n(4),l=i(n(1)),d=n(7);var c=n(12);t.default=({context:e},t,n={strict:!0})=>o(void 0,void 0,void 0,(function*(){var o;try{const{strict:i}=n;if((yield a.userModel.estimatedDocumentCount())<1)return!0;let p=e.req.headers;if(!p.authorization)throw new l.default("Missing Authorization Header",401);const u=p.authorization.split(" ")[1],f=r.default.verify(u,process.env.TOKEN_SECRET),y=yield a.userModel.findById(f.id,{password:0});if(!y)throw new l.default("Insufficient permissions to perform this action",401);c.set("req:user",y);let m=[];if(t.length){let e=yield d.roleModel.findById(y.role,{permissions:1}),n=yield s.permissionModel.find({$or:[{_id:{$in:null===(o=e)||void 0===o?void 0:o.permissions}},{_id:{$in:y.permissions}}]},{_id:0,name:1});if(m=n.map(e=>e.name),i){if(!t.every(e=>m.includes(e)))throw new l.default("Insufficient permissions for this query",403)}else if(!t.some(e=>m.includes(e)))throw new l.default("Insufficient permissions for this query",403)}if(y.tokenVersion!==f.tokenVersion)throw new l.default("Invalid token",401);return e.user=y,e.permissions=m,!0}catch({message:e,code:t}){throw"jwt expired"===e&&(t=401),new l.default(e,t)}}))},function(e,t){e.exports=require("helmet")},function(e,t){e.exports=require("express-sslify")},function(e,t,n){"use strict";var o=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(i,r){function a(e){try{l(o.next(e))}catch(e){r(e)}}function s(e){try{l(o.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}l((o=o.apply(e,t||[])).next())}))},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=n(7),a=n(2),s=n(4),l=n(14),d=i(n(1));t.default=()=>o(void 0,void 0,void 0,(function*(){try{const e=["adminRole","baseRole"];console.log(l.blue("Checking if the base roles exist..."));let t=yield r.roleModel.find({usedFor:{$in:e}},{id:0});t.length?console.log(l.greenBright("Base roles already created. No new roles created.")):(console.log(l.red("Base roles not created yet. proceeding to create base roles.")),console.log(l.greenBright(e.toString().replace(/,/g,"\n"))),t=yield r.roleModel.create([{name:"Admin",usedFor:"adminRole"},{name:"User",usedFor:"baseRole"}])),console.log(l.blue("Checking if any new permissions are needed..."));const n=Object.keys(a.mongoose.models).reduce((e,t)=>(t=t.toLowerCase(),e.push(`create_${t}s`),e.push(`read_all_${t}s`),e.push(`update_all_${t}s`),e.push(`delete_all_${t}s`),e),[]),o=["update_owned","read_owned","delete_owned"];let i=yield s.permissionModel.aggregate([{$match:{name:{$in:n}}},{$project:{name:1,_id:0}}]),d=yield s.permissionModel.aggregate([{$match:{name:{$in:o}}},{$project:{name:1,_id:0}}]);i=i.map(({name:e})=>e),d=d.map(({name:e})=>e);const c=n.filter(e=>!i.includes(e)),p=o.filter(e=>!d.includes(e));if(c.length){console.log(l.red("New permissions need to be created! Creating the following permissions and adding them to the adminRole: ")),console.log(l.greenBright(c.toString().replace(/,/g,"\n")));const e=yield s.permissionModel.create(c.map(e=>({name:e})));yield r.roleModel.findOneAndUpdate({usedFor:"adminRole"},{$push:{permissions:[...e]}})}if(p.length){console.log(l.red("New Base permissions need to be created! Creating the following permissions and adding them to the baseRole: ")),console.log(l.greenBright(p.toString().replace(/,/g,"\n")));const e=yield s.permissionModel.create(p.map(e=>({name:e})));yield r.roleModel.findOneAndUpdate({usedFor:"baseRole"},{$push:{permissions:[...e]}}),yield r.roleModel.findOneAndUpdate({usedFor:"adminRole"},{$push:{permissions:[...e]}})}console.log(l.blue("Done! starting the server."))}catch(e){throw new d.default(e)}}))},function(e,t,n){"use strict";var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=n(65),r=n(19),a=o(n(1));t.default=(e,t,n)=>{if(i.getComplexity({schema:n,query:e.operationName?r.separateOperations(t)[e.operationName]:t,variables:e.variables,estimators:[i.fieldExtensionsEstimator(),i.simpleEstimator({defaultComplexity:1})]})>20)throw new a.default("The complexity of the query exeeds the server allowed quota. Please contact the server admin.",413)}},function(e,t){e.exports=require("graphql-query-complexity")},function(e,t){e.exports=require("cors")}]);